# -*- coding: utf-8 -*-
# @Author: Dongqing Sun
# @E-mail: Dongqingsun96@gmail.com
# @Date:   2021-06-07 21:30:43
# @Last Modified by:   Dongqing Sun
# @Last Modified time: 2021-06-07 21:30:45

import os
import sys
import logging
import argparse as ap

from STRIDE.Deconvolution import DeconvolveParser, Deconvolve


def main():
    """
    Add main function argument parsers.
    """
    parser = ap.ArgumentParser(description = "STRIDE (Spatial TRanscRIptomics DEconvolution by topic modelling) is a cell-type deconvolution tool for spatial transcriptomics by using single-cell transcriptomics data. ")
    parser.add_argument("-v", "--version", action = "store_true", help = "Print version info.")

    subparsers = parser.add_subparsers(dest = "subcommand")
    DeconvolveParser(subparsers)
    logging.basicConfig(format="%(levelname)s: %(message)s", stream=sys.stderr)
    args = parser.parse_args()

    SCRIPT_PATH = os.path.dirname(__file__)
    version = open(os.path.join(SCRIPT_PATH, "version.txt"), "r").readline().strip()

    if args.version:
        print(version)
        exit(0)
    elif args.subcommand == "deconvolve":
        Deconvolve(sc_count_file = args.sc_count_file, sc_anno_file = args.sc_anno_file, st_count_file = args.st_count_file, 
                   sc_scale_factor = args.sc_scale_factor, st_scale_factor = args.st_scale_factor,
                   out_dir = args.out_dir, out_prefix = args.out_prefix, 
                   normalize = args.normalize, gene_use = args.gene_use, ntopics_list = args.ntopics_list)
    else:
        parser.print_help()
        exit(1)
    exit(0)


if __name__ == "__main__":
    main()

